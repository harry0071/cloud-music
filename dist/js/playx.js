(function () {
    "use strict";var view={el:"#app",template:"",render:function(i){this.template='<div id="bg" style="background-image:url('+i.bg+')"></div>\n    <div id="play">\n    <audio src="'+i.url+'"></audio>\n    <div class="logo-container">\n    <img src="../src/imgs/favicon.png" width=24 height=24><p class="logo">STAGE轻音乐</p></div>\n      <div class="disc-container">\n      <img class="pointer" src="//s3.music.126.net/m/s/img/needle-ip6.png?be4ebbeb6befadfcae75ce174e7db862 " alt="">\n      <div class="disc">\n          <span class="icon"></span>\n        <img class="ring" src="//s3.music.126.net/m/s/img/disc-ip6.png?69796123ad7cfe95781ea38aac8f2d48" alt="">\n        <img class="light" src="//s3.music.126.net/m/s/img/disc_light-ip6.png?996fc8a2bc62e1ab3f51f135fc459577" alt="">\n        <img src="'+i.pic+'" alt="" class="cover">\n      </div>\n    </div>\n    <div class="song-description">\n      <h1>'+i.songName+" - "+i.singer+'</h1>\n      <div class="lyric">\n        <div class="lines">\n          \n        </div>\n      </div>\n    </div>\n    <div class="links">\n      <a href="#">打开</a>\n      <a class="main" href="#">下载</a>\n    </div>\n    </div>',$(this.el).html(this.template)},parseLyric:function(i){for(var n=i.split("\n"),a=/\[\d+:\d+.\d+\]/g,e=[];!a.test(n[0]);)n=n.slice(1);return 0===n[n.length-1].length&&n.pop(),n.forEach(function(i,n,s){var t=i.match(a),c=i.replace(a,"");t.forEach(function(i,n,a){var s=i.slice(1,-1).split(":");e.push([60*parseInt(s[0])+parseFloat(s[1]),c])})}),e.sort(function(i,n){return i[0]-n[0]}),e}},model={data:{id:"",songName:"",singer:"",url:"",pic:"",lrc:"",bg:""},getSongbyId:function(i){var n=this;return $.get("https://api.imjad.cn/cloudmusic/?type=lyric&id="+i,function(i){i.lrc?n.data.lrc=i.lrc.lyric:n.data.lrc=""}).then(function(){return $.get("https://api.imjad.cn/cloudmusic/?type=detail&id="+i,function(a){var e="";e=a.songs[0].ar[1]?a.songs[0].ar[0].name+" / "+a.songs[0].ar[1].name:a.songs[0].ar[0].name,Object.assign(n.data,{id:i,songName:a.songs[0].name,singer:e,url:"http://music.163.com/song/media/outer/url?id="+i+".mp3",pic:a.songs[0].al.picUrl+"?imageView&thumbnail=170y170&quality=75&tostatic=0",bg:a.songs[0].al.picUrl+"?imageView&thumbnail=20y20&quality=75&tostatic=0"})})})}},controller={init:function(i,n){var a=this;this.view=i,this.model=n;var e=this.getSongId()||"";this.model.getSongbyId(e).then(function(){a.view.render(a.model.data);for(var i=a.view.parseLyric(a.model.data.lrc),n=0;n<i.length;n++)$("<p data-time="+i[n][0]+">"+i[n][1]+"</p>").appendTo(".lines")}),this.bindEvets()},bindEvets:function(){var i=this,n=!1;$(this.view.el).on("click",".disc",function(){var a=$("audio"),e=$(".icon"),s=$(".disc-container"),t=$(".pointer");n=!n,n?(a[0].play(),e.hide(),s.add(t).addClass("active"),a.on("ended",function(){n=!1,e.show(),s.add(t).removeClass("active")}),a.on("timeupdate",function(n){i.showLrc(a[0].currentTime)})):(a[0].pause(),e.show(),s.add(t).removeClass("active"))})},showLrc:function(i){var n=$(this.view.el).find(".lines>p"),a=$(this.view.el).find(".lines");n.each(function(e,s){var t=n.eq(e).data("time"),c=n.eq(e+1).data("time"),r=0;i>t&&i<c&&(r=32-n.eq(e).position().top,(r>0||0==e)&&(r=0),a.css({"-webkit-transform":"translateY("+r+"px)","-ms-transform":"translateY("+r+"px)",transform:"translateY("+r+"px)"}),n.removeClass("active").eq(e).addClass("active"))})},getSongId:function(){var i=location.search.slice(1),n=i.split("&");n=n.filter(function(i){return i});for(var a="",e=0;e<n.length;e++){var s=n[e].split("="),t=s[0],c=s[1];if("id"===t){a=c;break}}return a}};controller.init(view,model);
})();