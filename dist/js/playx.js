(function () {
"use strict";"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(i,n){if(null==i)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(i),t=1;t<arguments.length;t++){var a=arguments[t];if(null!=a)for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},writable:!0,configurable:!0});var view={el:"#app",template:"",render:function(i){this.template='<div id="bg" style="background-image:url('+i.bg+')"></div>\n    <div id="play">\n    <audio src="'+i.url+'"></audio>\n    <div class="logo-container">\n    <img src="../src/imgs/favicon.png" width=24 height=24><p class="logo">STAGE轻音乐</p></div>\n      <div class="disc-container">\n      <img class="pointer" src="//s3.music.126.net/m/s/img/needle-ip6.png?be4ebbeb6befadfcae75ce174e7db862 " alt="">\n      <div class="disc">\n          <span class="icon"></span>\n        <img class="ring" src="//s3.music.126.net/m/s/img/disc-ip6.png?69796123ad7cfe95781ea38aac8f2d48" alt="">\n        <img class="light" src="//s3.music.126.net/m/s/img/disc_light-ip6.png?996fc8a2bc62e1ab3f51f135fc459577" alt="">\n        <img src="'+i.pic+'" alt="" class="cover">\n      </div>\n    </div>\n    <div class="song-description">\n      <h1>'+i.songName+" - "+i.singer+'</h1>\n      <div class="lyric">\n        <div class="lines">\n          \n        </div>\n      </div>\n    </div>\n    <div class="links">\n      <a href="#">打开</a>\n      <a class="main" href="#">下载</a>\n    </div>\n    </div>',$(this.el).html(this.template)},parseLyric:function(i){for(var n=i.split("\n"),e=/\[\d+:\d+.\d+\]/g,t=[];!e.test(n[0]);)n=n.slice(1);return 0===n[n.length-1].length&&n.pop(),n.forEach(function(i,n,a){var s=i.match(e),r=i.replace(e,"");s.forEach(function(i,n,e){var a=i.slice(1,-1).split(":");t.push([60*parseInt(a[0])+parseFloat(a[1]),r])})}),t.sort(function(i,n){return i[0]-n[0]}),t}},model={data:{id:"",songName:"",singer:"",url:"",pic:"",lrc:"",bg:""},getSongbyId:function(i){var n=this;return $.get("https://api.imjad.cn/cloudmusic/?type=lyric&id="+i,function(i){i.lrc?n.data.lrc=i.lrc.lyric:n.data.lrc=""}).then(function(){return $.get("https://api.imjad.cn/cloudmusic/?type=detail&id="+i,function(e){var t="";t=e.songs[0].ar[1]?e.songs[0].ar[0].name+" / "+e.songs[0].ar[1].name:e.songs[0].ar[0].name,Object.assign(n.data,{id:i,songName:e.songs[0].name,singer:t,url:"http://music.163.com/song/media/outer/url?id="+i+".mp3",pic:e.songs[0].al.picUrl+"?imageView&thumbnail=170y170&quality=75&tostatic=0",bg:e.songs[0].al.picUrl+"?imageView&thumbnail=20y20&quality=75&tostatic=0"})})})}},controller={init:function(i,n){var e=this;this.view=i,this.model=n;var t=this.getSongId()||"";this.model.getSongbyId(t).then(function(){e.view.render(e.model.data);for(var i=e.view.parseLyric(e.model.data.lrc),n=0;n<i.length;n++)$("<p data-time="+i[n][0]+">"+i[n][1]+"</p>").appendTo(".lines")}),this.bindEvets()},bindEvets:function(){var i=this,n=!1;$(this.view.el).on("click",".disc",function(){var e=$("audio"),t=$(".icon"),a=$(".disc-container"),s=$(".pointer");n=!n,n?(e[0].play(),t.hide(),a.add(s).addClass("active"),e.on("ended",function(){n=!1,t.show(),a.add(s).removeClass("active")}),e.on("timeupdate",function(n){i.showLrc(e[0].currentTime)})):(e[0].pause(),t.show(),a.add(s).removeClass("active"))})},showLrc:function(i){var n=$(this.view.el).find(".lines>p"),e=$(this.view.el).find(".lines");n.each(function(t,a){var s=n.eq(t).data("time"),r=n.eq(t+1).data("time"),c=0;i>s&&i<r&&(c=32-n.eq(t).position().top,(c>0||0==t)&&(c=0),e.css({"-webkit-transform":"translateY("+c+"px)","-ms-transform":"translateY("+c+"px)",transform:"translateY("+c+"px)"}),n.removeClass("active").eq(t).addClass("active"))})},getSongId:function(){var i=location.search.slice(1),n=i.split("&");n=n.filter(function(i){return i});for(var e="",t=0;t<n.length;t++){var a=n[t].split("="),s=a[0],r=a[1];if("id"===s){e=r;break}}return e}};controller.init(view,model);
})();